<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetherfall | The Grand Grimoire</title>
    
    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/gold-bars.png">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=Uncial+Antiqua&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --parchment: #fdfaf3;
            --ink: #1a1a1a;
            --gold: #b8924e;
            --gold-bright: #e5c17e;
            --riot-red: #9e0101;       
            --aether-blue: #0077be;    
            --leather: #2b1d12;
            --glass: rgba(13, 13, 13, 0.95);
        }

        /* GLOBAL STYLES */
        * { margin:0; padding:0; box-sizing:border-box; }
        html { scroll-behavior: smooth; }
        body { background: #050505; color: var(--ink); font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        /* NAVIGATION & HUD */
        nav {
            position: fixed; top: 0; width: 100%; height: 70px;
            background: var(--glass); backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(184, 146, 78, 0.2);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; z-index: 1000;
        }
        .nav-logo-wrap { display: flex; align-items: center; gap: 15px; text-decoration: none; }
        .nav-logo { color: var(--gold); font-family: 'Uncial Antiqua'; font-size: 1.3rem; letter-spacing: 2px; }
        
        /* ARCHITECT DASHBOARD (HUD) */
        #architectHUD {
            display: none; position: fixed; bottom: 30px; right: 30px;
            background: var(--glass); border: 1px solid var(--gold);
            padding: 20px; border-radius: 12px; z-index: 2000;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 350px;
            color: #fff;
        }

        /* THE CHRONICLE ELEMENTS */
        .grimoire {
            width: 95%; max-width: 1200px; margin: 100px auto; 
            background: var(--parchment);
            background-image: url('https://www.transparenttextures.com/patterns/old-paper-2.png');
            box-shadow: 0 50px 100px rgba(0,0,0,0.9); border-radius: 4px;
            min-height: 100vh; position: relative;
        }
        
        header { text-align: center; padding: 120px 20px 80px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        header h1 { font-family: 'Uncial Antiqua'; font-size: 5rem; color: #111; line-height: 1; }
        header p { color: var(--gold); letter-spacing: 10px; font-weight: 600; text-transform: uppercase; margin-top: 10px; }

        .archives-section { padding: 80px 8%; display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px; }
        .char-card {
            background: #fff; padding: 40px 30px; border-radius: 8px;
            border-bottom: 4px solid var(--gold); transition: 0.4s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
        }
        .char-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.05); }

        /* ACT CARDS & CONTROLS */
        .chronicle-container { padding: 100px 15%; background: #fff; border-radius: 0 0 4px 4px; }
        .act-card { margin-bottom: 100px; position: relative; }
        .act-card h2 { font-family: 'Uncial Antiqua'; font-size: 2.5rem; margin-bottom: 15px; color: #111; }
        .act-card p { font-family: 'Crimson Text', serif; font-size: 1.3rem; color: #444; margin-bottom: 30px; text-align: justify;}
        
        .author-controls {
            display: flex; gap: 10px; margin-top: 20px;
            padding-top: 20px; border-top: 1px dashed #ddd;
        }

        /* BUTTONS */
        .btn {
            padding: 12px 25px; border: none; cursor: pointer;
            font-family: 'Inter'; font-weight: 600; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.3s;
            border-radius: 2px;
        }
        .btn-gold { background: var(--gold); color: #fff; }
        .btn-gold:hover { background: var(--leather); }
        .btn-outline { background: transparent; border: 1px solid var(--gold); color: var(--gold); }
        .btn-outline:hover { background: var(--gold); color: #fff; }
        .btn-danger { background: transparent; border: 1px solid var(--riot-red); color: var(--riot-red); }
        .btn-danger:hover { background: var(--riot-red); color: #fff; }

        /* AUTH MODAL */
        #authModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 5000; align-items: center; justify-content: center;
        }
        .auth-box {
            background: var(--parchment); padding: 50px; width: 400px; border-radius: 8px;
            text-align: center; border: 2px solid var(--gold);
        }
        .auth-input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            background: transparent; border: 1px solid #ccc; font-family: 'Inter';
        }

        /* READER */
        .reader-overlay {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: #000; z-index: 4000; overflow-y: auto; padding: 50px 0;
        }
        .scroll-paper {
            width: 90%; max-width: 800px; margin: 0 auto; background: var(--parchment);
            padding: 80px 60px; border-radius: 4px; position: relative;
        }

        @media (max-width: 900px) {
            .archives-section { grid-template-columns: 1fr; }
            header h1 { font-size: 3rem; }
            .chronicle-container { padding: 80px 8%; }
        }
    </style>
</head>
<body>

<nav>
    <a href="#" class="nav-logo-wrap">
        <div class="nav-logo">AETHERFALL</div>
    </a>
    <button class="btn btn-outline" id="authBtn">ARCHITECT LOGIN</button>
</nav>

<div id="architectHUD">
    <h3 style="font-family:'Uncial Antiqua'; color:var(--gold); margin-bottom:15px;">ARCHITECT COMMAND</h3>
    <input type="hidden" id="editId">
    <input type="text" id="actTitle" placeholder="Act Title" class="auth-input" style="color:#fff; border-color:#444;">
    <textarea id="actPreview" placeholder="Brief Preview" class="auth-input" style="color:#fff; border-color:#444; height:60px;"></textarea>
    <textarea id="actContent" placeholder="The Chronicle..." class="auth-input" style="color:#fff; border-color:#444; height:150px;"></textarea>
    <div style="display:flex; gap:10px;">
        <button class="btn btn-gold" id="saveBtn" style="flex:1;">MANIFEST</button>
        <button class="btn btn-danger" id="cancelBtn" style="display:none;">CANCEL</button>
    </div>
</div>

<div class="grimoire">
    <header>
        <p>The Grand Grimoire</p>
        <h1>Aetherfall</h1>
    </header>

    <section class="archives-section">
        <div class="char-card">
            <span style="color:var(--riot-red); font-weight:600; font-size:0.7rem; letter-spacing:2px;">THE CATALYST</span>
            <h2 style="font-family:'Uncial Antiqua'; margin: 10px 0;">Zyra Kade</h2>
            <p>Master of Overdrive magic. Where Zyra walks, the Lattice shatters.</p>
        </div>
        <div class="char-card">
            <span style="color:var(--aether-blue); font-weight:600; font-size:0.7rem; letter-spacing:2px;">THE ANCHOR</span>
            <h2 style="font-family:'Uncial Antiqua'; margin: 10px 0;">Aelira Virex</h2>
            <p>Commands the emotional tides of the Midstack. A living sanctuary.</p>
        </div>
        <div class="char-card">
            <span style="color:var(--gold); font-weight:600; font-size:0.7rem; letter-spacing:2px;">THE AUTHORITY</span>
            <h2 style="font-family:'Uncial Antiqua'; margin: 10px 0;">Sylva Morren</h2>
            <p>The Grand Architect of Law. Every contract is an unbreakable chain.</p>
        </div>
    </section>

    <div class="chronicle-container">
        <span style="color:var(--gold); letter-spacing:5px; font-weight:600; display:block; text-align:center; margin-bottom:50px;">LATEST CHRONICLES</span>
        <div id="dynamic-acts"></div>
    </div>
</div>

<div id="authModal">
    <div class="auth-box">
        <h2 style="font-family:'Uncial Antiqua'; margin-bottom:20px;">Rite of Initiation</h2>
        <input type="email" id="loginEmail" placeholder="Architect Email" class="auth-input">
        <input type="password" id="loginPass" placeholder="Secret Key" class="auth-input">
        <div style="display:flex; gap:10px;">
            <button class="btn btn-gold" id="executeLogin" style="flex:1;">SIGN IN</button>
            <button class="btn btn-outline" id="closeAuth">CLOSE</button>
        </div>
    </div>
</div>

<div id="readerOverlay" class="reader-overlay">
    <div class="scroll-paper">
        <button onclick="closeReader()" style="position:absolute; top:30px; right:30px; background:none; border:none; font-size:2rem; cursor:pointer;">&times;</button>
        <h2 id="readerTitle" style="font-family:'Uncial Antiqua'; font-size:3.5rem; color:var(--gold); margin-bottom:30px;"></h2>
        <div id="readerBody" style="font-family:'Crimson Text'; font-size:1.4rem; white-space:pre-wrap; line-height:1.8;"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDvY6EBbx55sK3F5ovjWDGexG9N58WXS-4",
        authDomain: "aetherfall-d35a2.firebaseapp.com",
        projectId: "aetherfall-d35a2",
        storageBucket: "aetherfall-d35a2.firebasestorage.app",
        messagingSenderId: "107057087956",
        appId: "1:107057087956:web:cd958bc57a400502d1c241"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const ADMIN_UID = "RJUAtLpVpoacDbdYORcUiSIU20v2";

    // LIVE RENDER
    onSnapshot(query(collection(db, "acts"), orderBy("createdAt", "desc")), (snap) => {
        const container = document.getElementById('dynamic-acts');
        container.innerHTML = "";
        snap.forEach(s => {
            const act = s.data();
            const id = s.id;
            window[`act_${id}`] = act;
            
            let adminControls = "";
            if(auth.currentUser && auth.currentUser.uid === ADMIN_UID) {
                adminControls = `
                    <div class="author-controls">
                        <button class="btn btn-outline" onclick="editAct('${id}')">EDIT</button>
                        <button class="btn btn-danger" onclick="deleteAct('${id}')">ERASE</button>
                    </div>
                `;
            }

            container.innerHTML += `
                <div class="act-card">
                    <h2>${act.title}</h2>
                    <p>${act.preview}</p>
                    <button class="btn btn-gold" onclick="openReader('${id}')">READ ACT</button>
                    ${adminControls}
                </div>
            `;
        });
    });

    // ARCHITECT ACTIONS
    document.getElementById('saveBtn').onclick = async () => {
        const title = document.getElementById('actTitle').value;
        const preview = document.getElementById('actPreview').value;
        const content = document.getElementById('actContent').value;
        const id = document.getElementById('editId').value;

        if(!title || !content) return alert("Fields incomplete.");

        try {
            if(id) {
                await updateDoc(doc(db, "acts", id), { title, preview, content });
                alert("Act Rewritten.");
            } else {
                await addDoc(collection(db, "acts"), { title, preview, content, createdAt: serverTimestamp() });
                alert("Act Manifested.");
            }
            resetHUD();
        } catch(e) { alert(e.message); }
    };

    window.editAct = (id) => {
        const act = window[`act_${id}`];
        document.getElementById('editId').value = id;
        document.getElementById('actTitle').value = act.title;
        document.getElementById('actPreview').value = act.preview;
        document.getElementById('actContent').value = act.content;
        document.getElementById('saveBtn').innerText = "UPDATE";
        document.getElementById('cancelBtn').style.display = "block";
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    };

    window.deleteAct = async (id) => {
        if(confirm("Erase this timeline forever?")) await deleteDoc(doc(db, "acts", id));
    };

    const resetHUD = () => {
        document.getElementById('editId').value = "";
        document.getElementById('actTitle').value = "";
        document.getElementById('actPreview').value = "";
        document.getElementById('actContent').value = "";
        document.getElementById('saveBtn').innerText = "MANIFEST";
        document.getElementById('cancelBtn').style.display = "none";
    };
    document.getElementById('cancelBtn').onclick = resetHUD;

    // AUTH SYSTEM
    document.getElementById('authBtn').onclick = () => {
        if(auth.currentUser) signOut(auth);
        else document.getElementById('authModal').style.display = "flex";
    };
    document.getElementById('closeAuth').onclick = () => document.getElementById('authModal').style.display = "none";
    
    document.getElementById('executeLogin').onclick = () => {
        const e = document.getElementById('loginEmail').value;
        const p = document.getElementById('loginPass').value;
        signInWithEmailAndPassword(auth, e, p)
            .then(() => document.getElementById('authModal').style.display = "none")
            .catch(err => alert("Access Denied."));
    };

    onAuthStateChanged(auth, (user) => {
        const isAdmin = user && user.uid === ADMIN_UID;
        document.getElementById('architectHUD').style.display = isAdmin ? "block" : "none";
        document.getElementById('authBtn').innerText = user ? "SIGNOUT" : "ARCHITECT LOGIN";
    });

    // READER
    window.openReader = (id) => {
        const act = window[`act_${id}`];
        document.getElementById('readerTitle').innerText = act.title;
        document.getElementById('readerBody').innerText = act.content;
        document.getElementById('readerOverlay').style.display = "block";
        document.body.style.overflow = "hidden";
    };
    window.closeReader = () => {
        document.getElementById('readerOverlay').style.display = "none";
        document.body.style.overflow = "auto";
    };
</script>

</body>
</html>
